<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>221207 SYSP | BONG-U&#39;s TIL</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="avata.png">
    <meta name="description" content="Today I Learned">
    
    <link rel="preload" href="/til-vuepress/assets/css/0.styles.32ca87a9.css" as="style"><link rel="preload" href="/til-vuepress/assets/js/app.341f1743.js" as="script"><link rel="preload" href="/til-vuepress/assets/js/2.378932c3.js" as="script"><link rel="preload" href="/til-vuepress/assets/js/10.f96603cb.js" as="script"><link rel="prefetch" href="/til-vuepress/assets/js/11.7636aa11.js"><link rel="prefetch" href="/til-vuepress/assets/js/12.f399ca0a.js"><link rel="prefetch" href="/til-vuepress/assets/js/13.8b0c211f.js"><link rel="prefetch" href="/til-vuepress/assets/js/14.68284e17.js"><link rel="prefetch" href="/til-vuepress/assets/js/15.aa590d6b.js"><link rel="prefetch" href="/til-vuepress/assets/js/16.9bcf75b5.js"><link rel="prefetch" href="/til-vuepress/assets/js/17.a3ac5b70.js"><link rel="prefetch" href="/til-vuepress/assets/js/18.e9b46dca.js"><link rel="prefetch" href="/til-vuepress/assets/js/19.e532055b.js"><link rel="prefetch" href="/til-vuepress/assets/js/20.38b26c78.js"><link rel="prefetch" href="/til-vuepress/assets/js/21.9b4be22e.js"><link rel="prefetch" href="/til-vuepress/assets/js/22.dfd29b50.js"><link rel="prefetch" href="/til-vuepress/assets/js/23.ca613615.js"><link rel="prefetch" href="/til-vuepress/assets/js/24.e488fe97.js"><link rel="prefetch" href="/til-vuepress/assets/js/25.01bf8907.js"><link rel="prefetch" href="/til-vuepress/assets/js/26.37ebba51.js"><link rel="prefetch" href="/til-vuepress/assets/js/27.eb2c3e9c.js"><link rel="prefetch" href="/til-vuepress/assets/js/28.e0c34b43.js"><link rel="prefetch" href="/til-vuepress/assets/js/29.ee472a59.js"><link rel="prefetch" href="/til-vuepress/assets/js/3.339d2952.js"><link rel="prefetch" href="/til-vuepress/assets/js/30.eeb6fadd.js"><link rel="prefetch" href="/til-vuepress/assets/js/31.3e5b829a.js"><link rel="prefetch" href="/til-vuepress/assets/js/32.182b66c5.js"><link rel="prefetch" href="/til-vuepress/assets/js/33.ea2b20ea.js"><link rel="prefetch" href="/til-vuepress/assets/js/34.11f0f0dd.js"><link rel="prefetch" href="/til-vuepress/assets/js/35.32672564.js"><link rel="prefetch" href="/til-vuepress/assets/js/36.32786b8e.js"><link rel="prefetch" href="/til-vuepress/assets/js/37.59703c98.js"><link rel="prefetch" href="/til-vuepress/assets/js/38.72fff1c5.js"><link rel="prefetch" href="/til-vuepress/assets/js/39.46e41fd1.js"><link rel="prefetch" href="/til-vuepress/assets/js/4.d471df20.js"><link rel="prefetch" href="/til-vuepress/assets/js/40.10cad699.js"><link rel="prefetch" href="/til-vuepress/assets/js/41.bf46cca1.js"><link rel="prefetch" href="/til-vuepress/assets/js/42.54289ab7.js"><link rel="prefetch" href="/til-vuepress/assets/js/43.dc31cb1f.js"><link rel="prefetch" href="/til-vuepress/assets/js/44.cabab11b.js"><link rel="prefetch" href="/til-vuepress/assets/js/45.1504c4e7.js"><link rel="prefetch" href="/til-vuepress/assets/js/46.0923d148.js"><link rel="prefetch" href="/til-vuepress/assets/js/47.3de870a3.js"><link rel="prefetch" href="/til-vuepress/assets/js/48.1ef26890.js"><link rel="prefetch" href="/til-vuepress/assets/js/49.68843bd8.js"><link rel="prefetch" href="/til-vuepress/assets/js/5.1da0fb78.js"><link rel="prefetch" href="/til-vuepress/assets/js/50.a09517ec.js"><link rel="prefetch" href="/til-vuepress/assets/js/51.d48f3365.js"><link rel="prefetch" href="/til-vuepress/assets/js/52.cdc21b71.js"><link rel="prefetch" href="/til-vuepress/assets/js/53.28f6320b.js"><link rel="prefetch" href="/til-vuepress/assets/js/54.16cfbf7d.js"><link rel="prefetch" href="/til-vuepress/assets/js/55.e8486499.js"><link rel="prefetch" href="/til-vuepress/assets/js/56.a0d89d84.js"><link rel="prefetch" href="/til-vuepress/assets/js/57.a68653aa.js"><link rel="prefetch" href="/til-vuepress/assets/js/58.284ad529.js"><link rel="prefetch" href="/til-vuepress/assets/js/59.6ba4810f.js"><link rel="prefetch" href="/til-vuepress/assets/js/6.9a49972a.js"><link rel="prefetch" href="/til-vuepress/assets/js/60.89af971f.js"><link rel="prefetch" href="/til-vuepress/assets/js/61.480791cb.js"><link rel="prefetch" href="/til-vuepress/assets/js/62.cb0ee836.js"><link rel="prefetch" href="/til-vuepress/assets/js/63.e2917816.js"><link rel="prefetch" href="/til-vuepress/assets/js/64.967c1285.js"><link rel="prefetch" href="/til-vuepress/assets/js/65.76581199.js"><link rel="prefetch" href="/til-vuepress/assets/js/7.e1bb4759.js"><link rel="prefetch" href="/til-vuepress/assets/js/8.fd5285f6.js"><link rel="prefetch" href="/til-vuepress/assets/js/9.cf0d5092.js">
    <link rel="stylesheet" href="/til-vuepress/assets/css/0.styles.32ca87a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/til-vuepress/" class="home-link router-link-active"><!----> <span class="site-name">BONG-U's TIL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>22-2</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/til-vuepress/22-2/MPLC.html" class="sidebar-link">MPLC (현대인의 생활문화)</a></li><li><a href="/til-vuepress/22-2/OOD.html" class="sidebar-link">OOD (객체지향설계)</a></li><li><a href="/til-vuepress/22-2/SYSP_09_11.html" aria-current="page" class="active sidebar-link">221207 SYSP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/til-vuepress/22-2/SYSP_09_11.html#목차" class="sidebar-link">목차</a></li><li class="sidebar-sub-header"><a href="/til-vuepress/22-2/SYSP_09_11.html#_09-process1" class="sidebar-link">09-process1</a></li><li class="sidebar-sub-header"><a href="/til-vuepress/22-2/SYSP_09_11.html#_10-process2" class="sidebar-link">10-process2</a></li><li class="sidebar-sub-header"><a href="/til-vuepress/22-2/SYSP_09_11.html#_11-signal-2" class="sidebar-link">11-signal</a></li></ul></li><li><a href="/til-vuepress/22-2/SYSP_12_13.html" class="sidebar-link">221208 SYSP</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Algorithm</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Study</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_221207-sysp"><a href="#_221207-sysp" class="header-anchor">#</a> 221207 SYSP</h1> <h2 id="목차"><a href="#목차" class="header-anchor">#</a> 목차</h2> <h3 id="_09-process-1"><a href="#_09-process-1" class="header-anchor">#</a> <a href="#09-process1">09 - process 1</a></h3> <h3 id="_10-process-2"><a href="#_10-process-2" class="header-anchor">#</a> <a href="#10-process2">10 - process 2</a></h3> <h3 id="_11-signal"><a href="#_11-signal" class="header-anchor">#</a> <a href="#11-signal">11 - signal</a></h3> <hr> <h2 id="_09-process1"><a href="#_09-process1" class="header-anchor">#</a> 09-process1</h2> <h3 id="예외적인-제어-흐름"><a href="#예외적인-제어-흐름" class="header-anchor">#</a> 예외적인 제어 흐름</h3> <ul><li>하위 매커니즘
<ol><li>예외 (Exception)</li></ol></li> <li>상위 매커니즘
<ol><li>프로세스 컨텍스트 전환
<ul><li>OS 소프트웨어와 하드웨어 타이머로 구현</li></ul></li> <li>시그널
<ul><li>OS 소프트웨어로 구현</li></ul></li> <li>nolocal 점프</li></ol></li></ul> <h3 id="예외-테이블-exception-tables"><a href="#예외-테이블-exception-tables" class="header-anchor">#</a> 예외 테이블 (Exception Tables)</h3> <ul><li>각 이벤트 타입은 예외번호 k를 갖는다</li></ul> <h3 id="비동기형-예외-interrupt"><a href="#비동기형-예외-interrupt" class="header-anchor">#</a> 비동기형 예외 (Interrupt)</h3> <ul><li><p>입출력 인터럽트 (ctrl + c)</p></li> <li><p>하드 리셋 인터러트</p></li> <li><p>소프트 리셋 인터럽트</p> <h3 id="동기형-예외"><a href="#동기형-예외" class="header-anchor">#</a> 동기형 예외</h3></li> <li><p>Traps : 명령어의 결과로 발생하는 의도적인 예외 (syscall)</p></li> <li><p>Faults : 핸들러가 정정할 수 있는 에러의 결과로 발생 (page faults)</p></li> <li><p>Aborts : 복구 불가능한 에러의 결과로 발생</p></li></ul> <h3 id="page-fault"><a href="#page-fault" class="header-anchor">#</a> Page Fault</h3> <ul><li><p>사용자 메모리의 특정 페이지가 현재 하드디스크에 위치하는 경우</p></li> <li><p>오류 처리후에 오류를 발생시킨 명령어를 다시 실행한다</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> a <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
a<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="process"><a href="#process" class="header-anchor">#</a> Process</h3> <blockquote><p>프로세스 : 운영체제가 만들어 주는 프로그램의 한 실행 예</p></blockquote></li> <li><p>프로그램에 2개의 중요한 추상화 제공</p> <ol><li>논리적인 제어 흐름 : 각 프로그램이 CPU를 독점하는 것처럼 보이게 한다</li> <li>사적인 주소 공간 : 각 프로그램이 주 메모리를 독점하는 것 처럼 보이도록 한다</li></ol></li> <li><p>어떻게?</p> <ol><li>프로세스의 실행이 서로 교대로 실행된다</li> <li>주소공간의 가상메모리 시스템에 의해 관리</li></ol></li></ul> <h3 id="multiprocessing-과거"><a href="#multiprocessing-과거" class="header-anchor">#</a> Multiprocessing (과거)</h3> <ol><li><p>현재 레지스터들을 메모리에 보관</p></li> <li><p>다음 프로세스를 실행하기 위해 스케쥴링</p></li> <li><p>보관된 레지스터들을 가져오고 주소공간을 전환 (context switch)</p> <h3 id="multiprocessing-현대"><a href="#multiprocessing-현대" class="header-anchor">#</a> Multiprocessing (현대)</h3></li> <li><p>멀티코어 프로세서</p></li> <li><p>각 코어는 별도의 프로세스를 실행 가능</p></li></ol> <h3 id="동시성-프로세스"><a href="#동시성-프로세스" class="header-anchor">#</a> 동시성 프로세스</h3> <ol><li>두 프로세스의 실행시간이 서로 중첩되면 -&gt; <b>concurrent</b></li> <li>중첩되지 않고 순차적으로 실행된다면 -&gt; <b>sequential</b></li></ol> <h3 id="fork"><a href="#fork" class="header-anchor">#</a> fork</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>호출하는 프로세스와 동일한 새 프로세스 생성</li> <li>자식 프로세스는 0을 리턴</li> <li>부모 프로세스는 자식 프로세스의 pid 리턴</li></ul> <h3 id="exit"><a href="#exit" class="header-anchor">#</a> exit</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span>
</code></pre></div><ul><li>종료 상태 status 값을 가지고 종료 (정상이면 0)</li> <li>atexit() 함수는 exit 할 때 실행할 함수를 등록</li></ul> <h3 id="좀비-zombies"><a href="#좀비-zombies" class="header-anchor">#</a> 좀비 (Zombies)</h3> <ul><li><p>종료되었지만, 아직 정리되지 않은 프로세스</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">fork8</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Running child, PID = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Terminating Parent, PID = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="_10-process2"><a href="#_10-process2" class="header-anchor">#</a> 10-process2</h2> <h3 id="wait"><a href="#wait" class="header-anchor">#</a> wait</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">wait</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>child_status<span class="token punctuation">)</span>
</code></pre></div><ul><li><p>현재 프로세스를 자신의 자식 프로세스들 중에 하나가 종료될 때까지 정지시킨다</p></li> <li><p>리턴값은 종료한 자식 프로세스의 PID</p></li> <li><p>child_status != NULL인 경우, 자식 프로그램의 종료 이유를 나타내는 상태정보를 갖는다</p></li> <li><p>example</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token class-name">pid_t</span> wpid <span class="token operator">=</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>child_status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WIFEXITED</span><span class="token punctuation">(</span>child_status<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Child %d terminated with exit status %d\n&quot;</span><span class="token punctuation">,</span> wpid<span class="token punctuation">,</span> <span class="token function">WEXITSTATUS</span><span class="token punctuation">(</span>child_status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Child %d terminate abnormally\n&quot;</span><span class="token punctuation">,</span> wpid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="waitpid"><a href="#waitpid" class="header-anchor">#</a> waitpid</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token function">waitpid</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>pid : 특정 pid의 프로세스를 기다린다. -1이면 wait()과 동일</p></li> <li><p>options : 0 (종료된 자식을 기다린다), WNOHANG(==1 한번만 체크), WUNTRACED(==2, 정지되거나 종료된 자식을 기다린다)</p> <h3 id="sleep"><a href="#sleep" class="header-anchor">#</a> sleep</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">// 자기 자신을 secs초 동안 정지</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> secs<span class="token punctuation">)</span>
<span class="token comment">// 호출하는 프로세스를 시그널 받을 때 까지 잠재운다</span>
<span class="token keyword">int</span> <span class="token function">pause</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="execve"><a href="#execve" class="header-anchor">#</a> execve</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">execve</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>envp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>실행 파일 filename을 현재 프로세스의 환경변수를 이용하면서 argv로 현재의 code, data, stack을 덮어 씌움</p></li> <li><p>example</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">execve</span><span class="token punctuation">(</span>myargv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> myargv<span class="token punctuation">,</span> environ<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s: Command not found.\n&quot;</span><span class="token punctuation">,</span> myargv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="shell"><a href="#shell" class="header-anchor">#</a> shell</h3> <blockquote><p>사용자의 명령을 처리해주는 응용 프로그램</p></blockquote> <ul><li>Utility : file로 구현된 명령어</li> <li>Built-in : 코드로 구현된 명령어</li></ul> <h3 id="eval"><a href="#eval" class="header-anchor">#</a> eval</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>cmdline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span>MAXARGS<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> bg<span class="token punctuation">;</span>
  <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>

  bg <span class="token operator">=</span> <span class="token function">parseline</span><span class="token punctuation">(</span>cmdline<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">builtin_command</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">execve</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> argv<span class="token punctuation">,</span> environ<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s: Command not found.\n&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> status<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitpid</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
        <span class="token function">unix_error</span><span class="token punctuation">(</span><span class="token string">&quot;waitfg: waitpid error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d %s&quot;</span><span class="token punctuation">,</span> pid<span class="token punctuation">,</span> cmdline<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>-&gt; 백그라운드 작업이 종료되면 zombie가 된다</p> <ul><li>해결방법 : <strong>signal</strong></li></ul> <h2 id="_11-signal-2"><a href="#_11-signal-2" class="header-anchor">#</a> 11-signal</h2> <h3 id="signal"><a href="#signal" class="header-anchor">#</a> Signal</h3> <blockquote><p>어떤 이벤트가 시스템에 발생했다는 것을 프로세스에게 알려주는 짧은 메시지</p></blockquote> <h3 id="receiving-a-signal"><a href="#receiving-a-signal" class="header-anchor">#</a> Receiving a signal</h3> <blockquote><p>목적지 프로세스가 시그널을 받을 때, 어떤 형태로든 반응을 하도록 커널에 의해 요구될때, 시그널을 받는다고 한다.</p></blockquote> <ul><li>3가지 반응
<ul><li>무시</li> <li>대상 프로세스를 종료</li> <li><strong>signal handler</strong>라고 부르는 유저레벨 함수를 실행하여 시그널을 잡는다</li></ul></li></ul> <h3 id="시그널의-특징"><a href="#시그널의-특징" class="header-anchor">#</a> 시그널의 특징</h3> <ul><li>프로세스는 특정 시그널의 수신을 블록할 수 있다.</li> <li>대기하는 시그널은 최대 한번만 수신할 수 있다.</li> <li>커널이 context에 가지고 있는 비트벡터
<ul><li>pending : 대기 시그널들을 표시
<ul><li>도착할때마다 pending값의 k번째 비트를 1로 설정</li> <li>수신할때마다 pending값의 k번째 비트를 0으로 설정</li></ul></li> <li>blocked : 블록된 시그널들을 표시
<ul><li>sigprocmask 함수를 사용하여 응용프로그램이 1또는 0로 설정</li></ul></li></ul></li></ul> <h3 id="프로세스-그룹"><a href="#프로세스-그룹" class="header-anchor">#</a> 프로세스 그룹</h3> <ul><li>각 프로세스는 하나의 프로세스 그룹에 속한다</li> <li>기본적으로 자식은 부모와 같은 그룹에 속한다</li> <li>쉘은 각 job마다 별도의 프로세스 그룹을 만든다</li> <li>getpgrp() : 프로세스의 프로세스 그룹을 리턴</li> <li>setpgid() : 프로세스의 그룹을 변경</li></ul> <h3 id="kill"><a href="#kill" class="header-anchor">#</a> kill</h3> <ul><li>kill -9 24818 : SIGKILL을 pid 24818로 보냄</li> <li>kill -9 -24817 : pgid 24871의 각 프로세스에 SIGKILL을 보냄</li></ul> <h3 id="키보드로부터-시그널-보내기"><a href="#키보드로부터-시그널-보내기" class="header-anchor">#</a> 키보드로부터 시그널 보내기</h3> <ul><li>키보드로 ctrl+c (ctrl+z)를 누르면 SIGINT(SIGTSTP) 시그널이 포그라운드 프로세스 그룹의 모든 작업으로 전송된다</li> <li>SIGINT : 각 프로세스를 모두 종료시킨다.</li> <li>SIGTSTP : 기본 동작은 각 프로세스를 정지시킨다.</li></ul> <h3 id="시그널-받기"><a href="#시그널-받기" class="header-anchor">#</a> 시그널 받기</h3> <ul><li>커널은 pnb = pending &amp; ~blocked 를 계산</li> <li>각 시그널 타입은 사전에 정의된 기본 동작을 가진다.</li> <li>기본 동작은 signal함수를 이용하여 변경이 가능한다
<strong>(SIGSTOP과 SIGKILL은 예외)</strong></li></ul> <h3 id="시그널-핸들러의-설치"><a href="#시그널-핸들러의-설치" class="header-anchor">#</a> 시그널 핸들러의 설치</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token class-name">handler_t</span> <span class="token operator">*</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> <span class="token class-name">handler_t</span> <span class="token operator">*</span>handler<span class="token punctuation">)</span>
</code></pre></div><ul><li>handler의 값
<ul><li>SIG_IGN : signum 타입 시그널 무시</li> <li>SIG_DFL : signum의 기본동작으로 복귀</li> <li>이외의 경우 : signal handler의 주소</li></ul></li></ul> <h3 id="시그널-블록하기와-해제하기"><a href="#시그널-블록하기와-해제하기" class="header-anchor">#</a> 시그널 블록하기와 해제하기</h3> <ul><li><p>sigprocmask 이용</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">sigprocmask</span><span class="token punctuation">(</span><span class="token keyword">int</span> how<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>oldest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>how값에 따라 동작이 결정된다</p> <ul><li>SIG_BLOCK : blocked = (blocked | set)</li> <li>SIG_UNBLOCK : blocked = blocked &amp; ~set</li> <li>SIG_SETMASK : blocked = set</li></ul></li> <li><p>set 관련 지원 함수</p> <ul><li>sigemptyset : 모든 시그널이 비어있는 집합 생성</li> <li>sigfillset : 모든 시그널 번호를 1로 설정</li> <li>sigaddset : 특정 시그널 번호를 1로 설정</li> <li>sigdelset : 특정 시그널 번호를 0으로 설정</li></ul></li></ul> <h3 id="경주-race-현상으로-인한-동기화의-문제"><a href="#경주-race-현상으로-인한-동기화의-문제" class="header-anchor">#</a> 경주 Race 현상으로 인한 동기화의 문제</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> olderrno <span class="token operator">=</span> errno<span class="token punctuation">;</span>
  <span class="token class-name">sigset_t</span> mask_all<span class="token punctuation">,</span> prev_all<span class="token punctuation">;</span>
  <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>

  <span class="token function">sigfillset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask_all<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pid <span class="token operator">=</span> <span class="token function">waitpid</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask_all<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev_all<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">deletejob</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev_all<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>errno <span class="token operator">!=</span> ECHILD<span class="token punctuation">)</span>
    <span class="token function">sio_error</span><span class="token punctuation">(</span><span class="token string">&quot;waitpid error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  errno <span class="token operator">=</span> olderno<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> pid<span class="token punctuation">;</span>
  <span class="token class-name">sigset_t</span> mask_all<span class="token punctuation">,</span> prev_all<span class="token punctuation">;</span>
  <span class="token keyword">int</span> n <span class="token operator">=</span> N<span class="token punctuation">;</span> <span class="token comment">// N = 5</span>
  <span class="token function">sigfillset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask_all<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">signal</span><span class="token punctuation">(</span>SIGCHLD<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">initjobs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">execve</span><span class="token punctuation">(</span><span class="token string">&quot;/bin/date&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// !! 여기서 SIGCHLD가 발생하면 오류</span>

    <span class="token comment">// 핸들러에서 job을 access하지 못하도록 모든 signal block</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask_all<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev_all<span class="token punctuation">)</span>류
    <span class="token function">addjob</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev_all<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>부모가 먼저 SIGCHLD 시그널이 터지기 전에 SIG_BLOCK하고 addjob을 하는 경우 -&gt; OK</li> <li>부모가 SIG_BLOCK하기 전에 자식이 끝나는 경우 handler가 먼저 실행된다 addjob하기전에 deletejob 수행
<ul><li>무한 루프 발생</li></ul></li></ul> <h3 id="경주현상을-회피하는-동기화-방법"><a href="#경주현상을-회피하는-동기화-방법" class="header-anchor">#</a> 경주현상을 회피하는 동기화 방법</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> pid<span class="token punctuation">;</span>
  <span class="token class-name">sigset_t</span> mask_all<span class="token punctuation">,</span> mask_one<span class="token punctuation">,</span> prev_one<span class="token punctuation">;</span>
  <span class="token keyword">int</span> n <span class="token operator">=</span> N<span class="token punctuation">;</span> <span class="token comment">// N = 5</span>
  <span class="token function">sigfillset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask_all<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask_one<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask_one<span class="token punctuation">,</span> SIGCHLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">signal</span><span class="token punctuation">(</span>SIGCHLD<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">initjobs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask_one<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev_one<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// block SIGCHILD</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 자식은 SIGCHLD를 block할 필요가 없으므로 다시 unblock</span>
      <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev_one<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// unblock SIGCHLD</span>
      <span class="token function">execve</span><span class="token punctuation">(</span><span class="token string">&quot;/bin/date&quot;</span><span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask_all<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addjob</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev_one<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>부모입장에서 fork가 실행되고 나서 SIGCHLD가 unblock 되는 순간이 단 한번도 존재 하지 않음.</li> <li>항상 addjob이 먼저 실행됨 -&gt; 오류 X</li></ul> <h3 id="명시적으로-핸들러를-기다리는-방식"><a href="#명시적으로-핸들러를-기다리는-방식" class="header-anchor">#</a> 명시적으로 핸들러를 기다리는 방식</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">volatile</span> <span class="token class-name">sig_atomic_t</span> pid<span class="token punctuation">;</span> <span class="token comment">// pid는 전역변수로 선언</span>
<span class="token keyword">void</span> <span class="token function">sigchld_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> orderrno <span class="token operator">=</span> errno<span class="token punctuation">;</span>
  <span class="token comment">// sigchld_handler에서 waitpid 하는 방식</span>
  pid <span class="token operator">=</span> <span class="token function">waitpid</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  errno <span class="token operator">=</span> olderrno<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">sigint_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">sigset_t</span> mask<span class="token punctuation">,</span> prev<span class="token punctuation">;</span>
  <span class="token keyword">int</span> n <span class="token operator">=</span> N<span class="token punctuation">;</span> <span class="token comment">// N = 10</span>
  <span class="token function">signal</span><span class="token punctuation">(</span>SIGCHLD<span class="token punctuation">,</span> sigchld_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> sigint_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> SIGCHLD<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// block SIGCHILD</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">// Wait for SIGCHLD to be recieved </span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>pid<span class="token punctuation">)</span>
      <span class="token punctuation">;</span>

    <span class="token comment">// Do some work after receiving SIGCHLD</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>sigsuspend를 사용한 시그널 동기화</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">sigsuspend</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 아래의 코드를 구현한 것과 동일</span>
<span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>sigsuspend를 이용한 시그널 기다리기</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">sigset_t</span> mask<span class="token punctuation">,</span> prev<span class="token punctuation">;</span>
<span class="token keyword">int</span> n <span class="token operator">=</span> N<span class="token punctuation">;</span> <span class="token comment">// N = 10</span>
<span class="token function">signal</span><span class="token punctuation">(</span>SIGCHLD<span class="token punctuation">,</span> sigchld_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> sigint_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> SIGCHLD<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// block SIGCHILD</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// Wait for SIGCHLD to be recieved </span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>pid<span class="token punctuation">)</span>
    <span class="token function">sigsuspend</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Optionally unblock SIGCHILD</span>
  <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Do some work after receiving SIGCHLD</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/til-vuepress/22-2/OOD.html" class="prev">
        OOD (객체지향설계)
      </a></span> <span class="next"><a href="/til-vuepress/22-2/SYSP_12_13.html">
        221208 SYSP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/til-vuepress/assets/js/app.341f1743.js" defer></script><script src="/til-vuepress/assets/js/2.378932c3.js" defer></script><script src="/til-vuepress/assets/js/10.f96603cb.js" defer></script>
  </body>
</html>
