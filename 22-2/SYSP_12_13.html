<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>221208 SYSP | BONG-U&#39;s TIL</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="avata.png">
    <meta name="description" content="Today I Learned">
    
    <link rel="preload" href="/til-vuepress/assets/css/0.styles.32ca87a9.css" as="style"><link rel="preload" href="/til-vuepress/assets/js/app.341f1743.js" as="script"><link rel="preload" href="/til-vuepress/assets/js/2.378932c3.js" as="script"><link rel="preload" href="/til-vuepress/assets/js/11.7636aa11.js" as="script"><link rel="prefetch" href="/til-vuepress/assets/js/10.f96603cb.js"><link rel="prefetch" href="/til-vuepress/assets/js/12.f399ca0a.js"><link rel="prefetch" href="/til-vuepress/assets/js/13.8b0c211f.js"><link rel="prefetch" href="/til-vuepress/assets/js/14.68284e17.js"><link rel="prefetch" href="/til-vuepress/assets/js/15.aa590d6b.js"><link rel="prefetch" href="/til-vuepress/assets/js/16.9bcf75b5.js"><link rel="prefetch" href="/til-vuepress/assets/js/17.a3ac5b70.js"><link rel="prefetch" href="/til-vuepress/assets/js/18.e9b46dca.js"><link rel="prefetch" href="/til-vuepress/assets/js/19.e532055b.js"><link rel="prefetch" href="/til-vuepress/assets/js/20.38b26c78.js"><link rel="prefetch" href="/til-vuepress/assets/js/21.9b4be22e.js"><link rel="prefetch" href="/til-vuepress/assets/js/22.dfd29b50.js"><link rel="prefetch" href="/til-vuepress/assets/js/23.ca613615.js"><link rel="prefetch" href="/til-vuepress/assets/js/24.e488fe97.js"><link rel="prefetch" href="/til-vuepress/assets/js/25.01bf8907.js"><link rel="prefetch" href="/til-vuepress/assets/js/26.37ebba51.js"><link rel="prefetch" href="/til-vuepress/assets/js/27.eb2c3e9c.js"><link rel="prefetch" href="/til-vuepress/assets/js/28.e0c34b43.js"><link rel="prefetch" href="/til-vuepress/assets/js/29.ee472a59.js"><link rel="prefetch" href="/til-vuepress/assets/js/3.339d2952.js"><link rel="prefetch" href="/til-vuepress/assets/js/30.eeb6fadd.js"><link rel="prefetch" href="/til-vuepress/assets/js/31.3e5b829a.js"><link rel="prefetch" href="/til-vuepress/assets/js/32.182b66c5.js"><link rel="prefetch" href="/til-vuepress/assets/js/33.ea2b20ea.js"><link rel="prefetch" href="/til-vuepress/assets/js/34.11f0f0dd.js"><link rel="prefetch" href="/til-vuepress/assets/js/35.32672564.js"><link rel="prefetch" href="/til-vuepress/assets/js/36.32786b8e.js"><link rel="prefetch" href="/til-vuepress/assets/js/37.59703c98.js"><link rel="prefetch" href="/til-vuepress/assets/js/38.72fff1c5.js"><link rel="prefetch" href="/til-vuepress/assets/js/39.46e41fd1.js"><link rel="prefetch" href="/til-vuepress/assets/js/4.d471df20.js"><link rel="prefetch" href="/til-vuepress/assets/js/40.10cad699.js"><link rel="prefetch" href="/til-vuepress/assets/js/41.bf46cca1.js"><link rel="prefetch" href="/til-vuepress/assets/js/42.54289ab7.js"><link rel="prefetch" href="/til-vuepress/assets/js/43.dc31cb1f.js"><link rel="prefetch" href="/til-vuepress/assets/js/44.cabab11b.js"><link rel="prefetch" href="/til-vuepress/assets/js/45.1504c4e7.js"><link rel="prefetch" href="/til-vuepress/assets/js/46.0923d148.js"><link rel="prefetch" href="/til-vuepress/assets/js/47.3de870a3.js"><link rel="prefetch" href="/til-vuepress/assets/js/48.1ef26890.js"><link rel="prefetch" href="/til-vuepress/assets/js/49.68843bd8.js"><link rel="prefetch" href="/til-vuepress/assets/js/5.1da0fb78.js"><link rel="prefetch" href="/til-vuepress/assets/js/50.a09517ec.js"><link rel="prefetch" href="/til-vuepress/assets/js/51.d48f3365.js"><link rel="prefetch" href="/til-vuepress/assets/js/52.cdc21b71.js"><link rel="prefetch" href="/til-vuepress/assets/js/53.28f6320b.js"><link rel="prefetch" href="/til-vuepress/assets/js/54.16cfbf7d.js"><link rel="prefetch" href="/til-vuepress/assets/js/55.e8486499.js"><link rel="prefetch" href="/til-vuepress/assets/js/56.a0d89d84.js"><link rel="prefetch" href="/til-vuepress/assets/js/57.a68653aa.js"><link rel="prefetch" href="/til-vuepress/assets/js/58.284ad529.js"><link rel="prefetch" href="/til-vuepress/assets/js/59.6ba4810f.js"><link rel="prefetch" href="/til-vuepress/assets/js/6.9a49972a.js"><link rel="prefetch" href="/til-vuepress/assets/js/60.89af971f.js"><link rel="prefetch" href="/til-vuepress/assets/js/61.480791cb.js"><link rel="prefetch" href="/til-vuepress/assets/js/62.cb0ee836.js"><link rel="prefetch" href="/til-vuepress/assets/js/63.e2917816.js"><link rel="prefetch" href="/til-vuepress/assets/js/64.967c1285.js"><link rel="prefetch" href="/til-vuepress/assets/js/65.76581199.js"><link rel="prefetch" href="/til-vuepress/assets/js/7.e1bb4759.js"><link rel="prefetch" href="/til-vuepress/assets/js/8.fd5285f6.js"><link rel="prefetch" href="/til-vuepress/assets/js/9.cf0d5092.js">
    <link rel="stylesheet" href="/til-vuepress/assets/css/0.styles.32ca87a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/til-vuepress/" class="home-link router-link-active"><!----> <span class="site-name">BONG-U's TIL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>22-2</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/til-vuepress/22-2/MPLC.html" class="sidebar-link">MPLC (현대인의 생활문화)</a></li><li><a href="/til-vuepress/22-2/OOD.html" class="sidebar-link">OOD (객체지향설계)</a></li><li><a href="/til-vuepress/22-2/SYSP_09_11.html" class="sidebar-link">221207 SYSP</a></li><li><a href="/til-vuepress/22-2/SYSP_12_13.html" aria-current="page" class="active sidebar-link">221208 SYSP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/til-vuepress/22-2/SYSP_12_13.html#목차" class="sidebar-link">목차</a></li><li class="sidebar-sub-header"><a href="/til-vuepress/22-2/SYSP_12_13.html#_12-memory-1-2" class="sidebar-link">12-memory-1</a></li><li class="sidebar-sub-header"><a href="/til-vuepress/22-2/SYSP_12_13.html#_13-memory-2-2" class="sidebar-link">13-memory-2</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Algorithm</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Study</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_221208-sysp"><a href="#_221208-sysp" class="header-anchor">#</a> 221208 SYSP</h1> <h2 id="목차"><a href="#목차" class="header-anchor">#</a> 목차</h2> <h3 id="_12-memory-1"><a href="#_12-memory-1" class="header-anchor">#</a> <a href="#12-memory-1">12 - memory 1</a></h3> <h3 id="_13-memory-2"><a href="#_13-memory-2" class="header-anchor">#</a> <a href="#13-memory-2">13 - memory 2</a></h3> <hr> <h2 id="_12-memory-1-2"><a href="#_12-memory-1-2" class="header-anchor">#</a> 12-memory-1</h2> <h3 id="메모리에-관한-불편한-진실"><a href="#메모리에-관한-불편한-진실" class="header-anchor">#</a> 메모리에 관한 불편한 진실</h3> <ul><li>메모리는 무한의 자원이 아니다</li></ul> <h3 id="동적-메모리-할당"><a href="#동적-메모리-할당" class="header-anchor">#</a> 동적 메모리 할당</h3> <ul><li>직접(explicit) vs 간접(implicit) 메모리 할당기
<ul><li>직접 할당 : 응용프로그램이 할당하고, 반환한다
<ul><li>ex) malloc, free</li></ul></li> <li>간접 할당 : 응용프로그램이 할당하지만, 반환하지는 않는다
<ul><li>ex) java의 garbage collector</li></ul></li></ul></li></ul> <h3 id="프로세스의-메모리-이미지"><a href="#프로세스의-메모리-이미지" class="header-anchor">#</a> 프로세스의 메모리 이미지</h3> <ul><li>스택은 아래로, 힙은 위로 성장한다</li> <li>sbrk 함수가 추가적인 힙 메모리를 운영체제로부터 요청한다 (brk 포인터 이동)</li></ul> <h3 id="malloc-package"><a href="#malloc-package" class="header-anchor">#</a> Malloc package</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> size<span class="token punctuation">)</span>
<span class="token comment">// 성공시 : 최소 size 바이트의 메모리 블록의 포인터를 반환 (대게 8바이트 단위로 맞추어)</span>
<span class="token comment">// 실패시 : NULL리턴, set errno</span>

<span class="token keyword">void</span> <span class="token function">free</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span>
<span class="token comment">// 가용 메모리 풀을 가리키는 블록 포인터 p 리턴</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">)</span>
<span class="token comment">// 블록 p의 크기를 변경하고, 새 블록의 포인터를 리턴</span>
<span class="token comment">// 새 블록의 내용은 이전 블록과 새 블록 크기 중 적은 크기까지는 변화 없음</span>
</code></pre></div><h3 id="우수한-malloc-free-프로그램의-목표"><a href="#우수한-malloc-free-프로그램의-목표" class="header-anchor">#</a> 우수한 malloc/free 프로그램의 목표</h3> <ol><li>주요 목표
<ul><li>malloc과 free에서 우수한 시간 성능을 얻는다</li> <li>우수한 공간 이용율을 가져야 한다</li></ul></li> <li>다른 목표
<ul><li>우수한 지역성 : 시간적으로 인접 (또는 유사한 객체) -&gt; 공간상으로 인접</li> <li>견고성 : free(p1) 함수가 유효한 포인터 p1에 대해 수행하는지 체크할 수 있다.</li></ul></li></ol> <h3 id="성능-지표-1-처리량-throughput"><a href="#성능-지표-1-처리량-throughput" class="header-anchor">#</a> 성능 지표 1 : 처리량 (Throughput)</h3> <ul><li><p>단위 시간 동안 완료한 요청의 수</p> <h3 id="성능-지표-2-최대-메모리-이용율-utilization"><a href="#성능-지표-2-최대-메모리-이용율-utilization" class="header-anchor">#</a> 성능 지표 2 : 최대 메모리 이용율 (Utilization)</h3></li> <li><p>k개의 요청 후에, 최대 메모리 이용율
$$ U_{k} = (max_{i&lt;=k}: P_{i}) / H_{k} $$</p></li></ul> <h3 id="내부-메모리-단편화-internal-fragmentation"><a href="#내부-메모리-단편화-internal-fragmentation" class="header-anchor">#</a> 내부 메모리 단편화 (Internal Fragmentation)</h3> <ul><li>일부 블록에서 블록 크기와 데이터 크기간의 차이로 인해 발생</li> <li>이전 요청 패턴에 의해서만 영향을 받으므로 <strong>측정이 용이</strong></li></ul> <h3 id="외부-메모리-단편화-external-fragmentation"><a href="#외부-메모리-단편화-external-fragmentation" class="header-anchor">#</a> 외부 메모리 단편화 (External Fragmentation)</h3> <ul><li>힙 전체 메모리를 합치면 수용이 가능하지만 가용 블록의 크기가 작은 경우에 발생</li> <li>외부 단편화는 미래의 요청 패턴에 의해 결정되므로 <strong>측정이 어렵다</strong></li></ul> <h3 id="free-블럭-관리하기"><a href="#free-블럭-관리하기" class="header-anchor">#</a> Free 블럭 관리하기</h3> <ol><li>간접리스트 : 크기 정보를 이용하여 모든 블록을 연결</li> <li>직접리스트 : 가용 블록내에 포인터를 이용</li> <li>구분 가용리스트 : 크기 클래스마다 별도의 가용 리스트를 유지</li> <li>크기로 정렬된 블록</li></ol> <h3 id="방법-1-간접-리스트-방식-implicit-list"><a href="#방법-1-간접-리스트-방식-implicit-list" class="header-anchor">#</a> 방법 1 : 간접 리스트 방식 (Implicit List)</h3> <ul><li><p>1 word = size(a) + payload + padding</p></li> <li><p>연습문제</p> <blockquote><p>제한사항 : 헤더는 4바이트, double-word alignment, 블록의 크기는 8의 배수</p></blockquote> <table><thead><tr><th>요청</th> <th>block size</th> <th>block header(hex)</th></tr></thead> <tbody><tr><td>Malloc(1)</td> <td>4+1+3 = 8</td> <td>size | alloc = 0x8 | 1 = 0x9</td></tr> <tr><td>Malloc(5)</td> <td>4+5+7 = 16</td> <td>size | alloc = 0x8 | 5 = 0xD</td></tr> <tr><td>Malloc(12)</td> <td>4+12+0 = 16</td> <td>size | alloc = 0x8 | 12 = 0x1A</td></tr> <tr><td>Malloc(13)</td> <td>4+13+7 = 24</td> <td>size | alloc = 0x8 | 13 = 0x1B</td></tr></tbody></table></li></ul> <h3 id="간접-리스트-free-블록-찾기"><a href="#간접-리스트-free-블록-찾기" class="header-anchor">#</a> 간접 리스트 : Free 블록 찾기</h3> <ol><li>First fit</li> <li>Next fit</li> <li>Best fit</li></ol> <h3 id="간접-리스트-결합-coalescing"><a href="#간접-리스트-결합-coalescing" class="header-anchor">#</a> 간접 리스트 : 결합 (Coalescing)</h3> <ul><li>free할때 해당 블록의 할당 플래그만 0으로 세팅 -&gt; 잘못된 단편화 발생</li> <li>free하는 블록의 이전과 다음 블록을 함께 연결해서 더 큰 free블록을 만든다</li></ul> <h3 id="간접-리스트-양방향-연결"><a href="#간접-리스트-양방향-연결" class="header-anchor">#</a> 간접 리스트 : 양방향 연결</h3> <ul><li>경계 태그 (Boundary tags)</li> <li>header를 복제해서 블록의 마지막에 넣는다 (-&gt; footer)</li></ul> <h2 id="_13-memory-2-2"><a href="#_13-memory-2-2" class="header-anchor">#</a> 13-memory-2</h2> <h3 id="직접-리스트"><a href="#직접-리스트" class="header-anchor">#</a> 직접 리스트</h3> <ul><li>가용 블록들의 리스트만을 관리하면, 모든 블록을 관리하지 않는다</li> <li>연결 링크는 메모리 블럭의 순서와 무관하다</li></ul> <h3 id="직접-리스트-free"><a href="#직접-리스트-free" class="header-anchor">#</a> 직접 리스트 : Free</h3> <ul><li>새롭게 반환한 블록은 가용리스트의 어느 위치에 끼워 넣어야 하는가?</li></ul> <ol><li>LIFO (last in first out) 정책 : 반환블록을 리스트 맨 앞에 끼워넣는 방법 -&gt; 빠른 시간, 나쁜 단편화 성능</li> <li>주소정렬 정책 : 블록들의 주소가 순서를 유지하도록 삽입 -&gt; 느린 시간, 우수한 단편화 성능</li></ol> <h3 id="직접리스트-간접리스트"><a href="#직접리스트-간접리스트" class="header-anchor">#</a> 직접리스트 &lt;-&gt; 간접리스트</h3> <ul><li>할당시간이 전체 블록의 수가 아니라 가용블록 수에 비례한다</li> <li>할당과 반환 과정이 복잡하다.</li> <li>링크 포인터 저장을 위해 추가적인 공간이 필요하다 (블록마다 2워드 추가 필요)</li></ul> <h3 id="구분-가용-리스트-segrated-free-list"><a href="#구분-가용-리스트-segrated-free-list" class="header-anchor">#</a> 구분 가용 리스트 (segrated free list)</h3> <ul><li><p>각 크기 클래스들은 클래스마다의 블록들을 관리한다</p></li> <li><p>크기 n의 블록 할당 방법</p> <ul><li><p>크기 n의 블록 리스트가 비어있지 않은 경우</p> <ol><li>리스트의 첫 블록을 할당한다.</li></ol></li> <li><p>가용리스트가 비어 있는 경우</p> <ol><li>새 페이지를 할당받는다 (OS로부터 sbrk()를 사용하여)</li> <li>이 페이지의 모든 블록들로부터 새로운 가용리스트를 생성한다</li> <li>리스트의 첫 블록을 할당한다</li></ol></li> <li><p>블록 반환 방법</p> <ul><li>가용 리스트에 추가</li> <li>블록 연결 후 해당 클래스 가용리스트에 추가</li></ul></li></ul></li> <li><p>장점</p> <ul><li>높은 처리량</li> <li>우수한 메모리 이용률</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/til-vuepress/22-2/SYSP_09_11.html" class="prev">
        221207 SYSP
      </a></span> <span class="next"><a href="/til-vuepress/Algorithm/BOJ_1010.html">
        1010 : 다리놓기 (S5)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/til-vuepress/assets/js/app.341f1743.js" defer></script><script src="/til-vuepress/assets/js/2.378932c3.js" defer></script><script src="/til-vuepress/assets/js/11.7636aa11.js" defer></script>
  </body>
</html>
